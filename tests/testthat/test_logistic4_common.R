context("Four-parameter logistic common functions")

test_that("Value of the four-parameter logistic function", {
  x <- -log(c(1000, 100, 10, 1, 0.1))
  param <- c(4 / 10, 9 / 10, -2, -3 / 2)

  value <- logistic4_function(x, param)
  true_value <- c(
    0.89998995743324875, 0.89899773625438754, 0.81636987501652544,
    0.42371293658878339, 0.40024881146590468
  )

  expect_type(value, "double")
  expect_length(value, 5)
  expect_equal(value, true_value)
})

test_that("Gradient of the four-parameter logistic function", {
  x <- -log(c(1000, 100, 10, 1, 0.1))
  param <- c(4 / 10, 9 / 10, -2, -3 / 2)

  gradient <- logistic4_gradient(x, param)
  true_value <- matrix(
    c(
      # alpha
      0.00002008513350250, 0.00200452749122491, 0.16726024996694912,
      0.95257412682243322, 0.99950237706819063,
      # beta
      0.99997991486649750, 0.99799547250877509, 0.83273975003305088,
      0.04742587317756678, 0.00049762293180937,
      # eta
      -0.0000543066525853, -0.00310596101191387, -0.0558937348799122,
      0.033882494798184099, 0.00094565595683739,
      # phi
      0.00002008473008991, 0.00200050936076184, 0.13928425874794282,
      0.04517665973091213, 0.00049737530322710
    ),
    nrow = 5,
    ncol = 4
  )

  expect_type(gradient, "double")
  expect_length(gradient, 5 * 4)
  expect_equal(gradient, true_value)
})

test_that("Hessian of the four-parameter logistic function", {
  x <- -log(c(1000, 100, 10, 1, 0.1))
  param <- c(4 / 10, 9 / 10, -2, -3 / 2)

  hessian <- logistic4_hessian(x, param)
  true_value <- array(
    c(
      # (alpha, alpha)
      rep(0, 5),
      # (alpha, beta)
      rep(0, 5),
      # (alpha, eta)
      0.000108613305, 0.006211922024, 0.111787469760, -0.067764989596,
      -0.001891311914,
      # (alpha, phi)
      -0.000040169460, -0.004001018722, -0.278568517496, -0.090353319462,
      -0.000994750606,
      # (beta, alpha)
      rep(0, 5),
      # (beta, beta)
      rep(0, 5),
      # (beta, eta)
      -0.000108613305, -0.006211922024, -0.111787469760, 0.067764989596,
      0.001891311914,
      # (beta, phi)
      0.000040169460, 0.004001018722, 0.278568517496, 0.090353319462,
      0.000994750606,
      # (eta, alpha)
      0.000108613305, 0.006211922024, 0.111787469760, -0.067764989596,
      -0.001891311914,
      # (eta, beta)
      -0.000108613305, -0.006211922024, -0.111787469760, 0.067764989596,
      0.001891311914,
      # (eta, eta)
      -0.000293665290, -0.009605872052, -0.029853063263, 0.046003021494,
      0.003592358403,
      # (eta, phi)
      0.000098566577, 0.005186763407, 0.004750140115, 0.038749032126,
      0.001640741942,
      # (phi, alpha)
      -0.000040169460, -0.004001018722, -0.278568517496, -0.090353319462,
      -0.000994750606,
      # (phi, beta)
      0.000040169460, 0.004001018722, 0.278568517496, 0.090353319462,
      0.000994750606,
      # (phi, eta)
      0.000098566577, 0.005186763407, 0.004750140115, 0.038749032126,
      0.001640741942,
      # (phi, phi)
      -0.000040167847, -0.003984978417, -0.185381637757, 0.081783149322,
      0.000993760585
    ),
    dim = c(5, 4, 4)
  )

  expect_type(hessian, "double")
  expect_length(hessian, 5 * 4 * 4)
  expect_equal(hessian, true_value)
})
